name: Trigger application UI testing
run-name: Trigger application UI testing

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    uses: ./.github/workflows/cloud-run-deploy.yaml
    permissions:
      contents: read
      security-events: write
      actions: read
      id-token: write
    secrets:
      GCPToken: ${{ secrets.GCP_SA_KEY }}

  trigger-ui-tests:
    name: Trigger UI Tests
    runs-on: ubuntu-latest
    needs: [deploy]
    steps:
      - name: Trigger Chrome UI Testing
        uses: convictional/trigger-workflow-and-wait@v1.6.1
        with:
          owner: QxaM
          repo: employee-and-work-order-management-ui-tests
          github_token: ${{ secrets.REPOSITORY_TOKEN }}
          github_user: github-user
          workflow_file_name: chrome-test.yaml
          ref: main
          wait_interval: 10
          client_payload: '{}'
          propagate_failure: false
          trigger_workflow: true
          wait_workflow: false